<!DOCTYPE html>
<html lang="en">
  <head>
    <title>المستخدمين - لوحة التحكم</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
      .modal-bg { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.2); z-index:2000; display:none; }
      .modal-content { background:#fff; max-width:500px; margin:40px auto; border-radius:8px; padding:32px; position:relative; }
    </style>
    <script>
      // Demo roles (simulate from roles page/database)
      const roles = [
        { id: 1, name: 'مدير' },
        { id: 2, name: 'محاسب' },
        { id: 3, name: 'مستخدم' },
        { id: 4, name: 'مشرف' }
      ];
      // Demo users
      let users = [
        { id: 1, name: 'أحمد زيد', email: 'azid@email.com', roleId: 1 },
        { id: 2, name: 'منى جمال', email: 'mona@email.com', roleId: 2 }
      ];
      let editUserId = null;
      function renderUsersTable() {
        const tbody = users.map(u => {
          const role = roles.find(r => r.id === u.roleId);
          return `<tr>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${role ? role.name : ''}</td>
            <td>
              <button class='btn btn-sm btn-outline-success' onclick='showUserModal(${u.id})'>تعديل</button>
              <button class='btn btn-sm btn-outline-danger' onclick='deleteUser(${u.id})'>حذف</button>
            </td>
          </tr>`;
        }).join('');
        document.getElementById('usersTbody').innerHTML = tbody;
      }
      function showUserModal(id = null) {
        editUserId = id;
        const modal = document.getElementById('userModal');
        const nameInput = document.getElementById('userName');
        const emailInput = document.getElementById('userEmail');
        const passInput = document.getElementById('userPassword');
        const roleSelect = document.getElementById('userRole');
        nameInput.value = '';
        emailInput.value = '';
        passInput.value = '';
        roleSelect.innerHTML = roles.map(r => `<option value='${r.id}'>${r.name}</option>`).join('');
        if(id) {
          const user = users.find(u => u.id === id);
          nameInput.value = user.name;
          emailInput.value = user.email;
          roleSelect.value = user.roleId;
          passInput.placeholder = 'اتركه فارغاً للإبقاء على كلمة المرور الحالية';
        } else {
          passInput.placeholder = '';
        }
        modal.style.display = 'block';
      }
      function closeUserModal() {
        document.getElementById('userModal').style.display = 'none';
      }
      function saveUser() {
        const name = document.getElementById('userName').value.trim();
        const email = document.getElementById('userEmail').value.trim();
        const pass = document.getElementById('userPassword').value;
        const roleId = parseInt(document.getElementById('userRole').value);
        if(!name || !email || !roleId) { alert('يرجى إدخال جميع البيانات'); return; }
        if(editUserId) {
          const idx = users.findIndex(u => u.id === editUserId);
          users[idx].name = name;
          users[idx].email = email;
          users[idx].roleId = roleId;
          // Password update is ignored in demo
        } else {
          const newId = users.length ? Math.max(...users.map(u => u.id)) + 1 : 1;
          users.push({ id: newId, name, email, roleId });
        }
        closeUserModal();
        renderUsersTable();
      }
      function deleteUser(id) {
        if(confirm('هل أنت متأكد من حذف هذا المستخدم؟')) {
          users = users.filter(u => u.id !== id);
          renderUsersTable();
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        renderUsersTable();
        document.getElementById('addUserBtn').onclick = () => showUserModal();
        document.getElementById('closeUserModal').onclick = closeUserModal;
        document.getElementById('saveUserBtn').onclick = saveUser;
      });
    </script>
  </head>
  <body dir="rtl" style="background:#f8f9fa;">
    <!-- Top contact/social bar -->
    <div class="wrap">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="bg-wrap">
              <div class="row">
                <div class="col-md-6 d-flex align-items-center">
                  <p class="mb-0 phone pl-md-2">
                    <a href="tel:+201094056919" class="mr-2"><span class="fa fa-phone mr-1"></span>+201009091082 - +201094056919</a> 
                    <a href="mailto:aamtechco@gmail.com?subject=تواصل&body=مرحبا%20اريد%20التواصل%20معكم"><span class="fa fa-paper-plane mr-1">aamtechco@gmail.com</span></a>
                  </p>
                </div>
                <div class="col-md-6 d-flex justify-content-md-end">
                  <div class="social-media">
                    <p class="mb-0 d-flex">
                      <a href="https://www.facebook.com/aboelmagdzaidoffice/" target="_blank" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-facebook"><i class="sr-only">Facebook</i></span>
                      </a>
                      <a href="https://www.instagram.com/aboelmagd.megzawy" target="_blank" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-instagram"><i class="sr-only">Instagram</i></span>
                      </a>
                      <a href="office-sys/index.html" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-dribbble"><i class="sr-only">Dribbble</i></span>
                      </a>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Dashboard Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm" style="border-bottom:1px solid #eee;">
      <div class="container">
        <ul class="navbar-nav mx-auto flex-row d-flex justify-content-center w-100">
          <li class="nav-item mx-2"><a class="nav-link" href="dashboard.html"><span class="fa fa-dashboard ml-1"></span>لوحة التحكم</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="tasks.html"><span class="fa fa-tasks ml-1"></span>المهام</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="clients.html"><span class="fa fa-users ml-1"></span>العملاء</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="offices.html"><span class="fa fa-building ml-1"></span>المكاتب</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="reports.html"><span class="fa fa-bar-chart ml-1"></span>التقارير</a></li>
          <li class="nav-item mx-2 active"><a class="nav-link" href="users.html"><span class="fa fa-user ml-1"></span>المستخدمين</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="roles.html"><span class="fa fa-lock ml-1"></span>الصلاحيات</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="database.html"><span class="fa fa-database ml-1"></span>قاعدة البيانات</a></li>
        </ul>
        <a href="login.html" class="btn btn-danger px-3">تسجيل الخروج</a>
      </div>
    </nav>
    <!-- Users Section -->
    <section class="hero-wrap" style="background-image:url('images/person_1.jpg'); background-size:cover; background-position:center; min-height:300px; position:relative;">
      <div class="overlay" style="background:rgba(0,0,0,0.5);"></div>
      <div class="container">
        <div class="row justify-content-center align-items-center" style="min-height:300px;">
          <div class="col-md-8 heading-section text-center ftco-animate text-white" style="position:relative; z-index:2;">
            <span class="subheading" style="color:#fff;">المستخدمين</span>
            <h2 style="color:#fff;">إدارة المستخدمين</h2>
            <p style="color:#eee;">هنا يمكنك إضافة وتعديل بيانات المستخدمين والصلاحيات.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="ftco-section" style="background:#fff; border-radius:8px; margin-bottom:32px;">
      <div class="container py-4">
        <div class="row">
          <div class="col-12">
            <div class="card shadow-lg animate__animated animate__fadeInUp">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <button class="btn btn-secondary" id="addUserBtn"><span class="fa fa-plus ml-1"></span>إضافة مستخدم جديد</button>
                </div>
                <div class="table-responsive">
                  <table class="table table-bordered text-center mb-0">
                    <thead class="thead-light">
                      <tr>
                        <th>الاسم</th>
                        <th>البريد الإلكتروني</th>
                        <th>الدور</th>
                        <th>إجراءات</th>
                      </tr>
                    </thead>
                    <tbody id="usersTbody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- User Modal -->
    <div id="userModal" class="modal-bg">
      <div class="modal-content">
        <button id="closeUserModal" style="position:absolute; left:16px; top:16px; background:none; border:none; font-size:24px;">&times;</button>
        <h5 class="mb-3">إضافة / تعديل مستخدم</h5>
        <div class="form-group">
          <label>الاسم</label>
          <input type="text" class="form-control" id="userName" placeholder="ادخل اسم المستخدم">
        </div>
        <div class="form-group">
          <label>البريد الإلكتروني</label>
          <input type="email" class="form-control" id="userEmail" placeholder="ادخل البريد الإلكتروني">
        </div>
        <div class="form-group">
          <label>كلمة المرور</label>
          <input type="password" class="form-control" id="userPassword" placeholder="ادخل كلمة المرور">
        </div>
        <div class="form-group">
          <label>الدور</label>
          <select class="form-control" id="userRole"></select>
        </div>
        <button class="btn btn-success" id="saveUserBtn">حفظ</button>
      </div>
    </div>
    <footer class="footer mt-5">
      <div class="container-fluid px-lg-5">
        <div class="row">
          <div class="col-md-12 text-center py-3">
            <p class="copyright">
              &copy;<script>document.write(new Date().getFullYear());</script> جميع الحقوق محفوظة | تم التصميم والتطوير بواسطة <a href="https://www.instagram.com/aboelmagd.megzawy/" target="_blank">أحمد زيد</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
