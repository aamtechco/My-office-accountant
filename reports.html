<!DOCTYPE html>
<html lang="en">
  <head>
    <title>التقارير - لوحة التحكم</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body dir="rtl" style="background:#f8f9fa;">
    <!-- Top contact/social bar -->
    <div class="wrap">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="bg-wrap">
              <div class="row">
                <div class="col-md-6 d-flex align-items-center">
                  <p class="mb-0 phone pl-md-2">
                    <a href="tel:+201094056919" class="mr-2"><span class="fa fa-phone mr-1"></span>+201009091082 - +201094056919</a> 
                    <a href="mailto:aamtechco@gmail.com?subject=تواصل&body=مرحبا%20اريد%20التواصل%20معكم"><span class="fa fa-paper-plane mr-1">aamtechco@gmail.com</span></a>
                  </p>
                </div>
                <div class="col-md-6 d-flex justify-content-md-end">
                  <div class="social-media">
                    <p class="mb-0 d-flex">
                      <a href="https://www.facebook.com/aboelmagdzaidoffice/" target="_blank" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-facebook"><i class="sr-only">Facebook</i></span>
                      </a>
                      <a href="https://www.instagram.com/aboelmagd.megzawy" target="_blank" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-instagram"><i class="sr-only">Instagram</i></span>
                      </a>
                      <a href="office-sys/index.html" class="d-flex align-items-center justify-content-center">
                        <span class="fa fa-dribbble"><i class="sr-only">Dribbble</i></span>
                      </a>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Dashboard Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm" style="border-bottom:1px solid #eee;">
      <div class="container">
        <ul class="navbar-nav mx-auto flex-row d-flex justify-content-center w-100">
          <li class="nav-item mx-2"><a class="nav-link" href="dashboard.html"><span class="fa fa-dashboard ml-1"></span>لوحة التحكم</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="tasks.html"><span class="fa fa-tasks ml-1"></span>المهام</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="clients.html"><span class="fa fa-users ml-1"></span>العملاء</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="offices.html"><span class="fa fa-building ml-1"></span>المكاتب</a></li>
          <li class="nav-item mx-2 active"><a class="nav-link" href="reports.html"><span class="fa fa-bar-chart ml-1"></span>التقارير</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="users.html"><span class="fa fa-user ml-1"></span>المستخدمين</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="roles.html"><span class="fa fa-lock ml-1"></span>الصلاحيات</a></li>
          <li class="nav-item mx-2"><a class="nav-link" href="database.html"><span class="fa fa-database ml-1"></span>قاعدة البيانات</a></li>
        </ul>
        <a href="login.html" class="btn btn-danger px-3">تسجيل الخروج</a>
      </div>
    </nav>
    <!-- Reports Section -->
    <section class="hero-wrap" style="background-image:url('images/bg_2.jpg'); background-size:cover; background-position:center; min-height:300px; position:relative;">
      <div class="overlay" style="background:rgba(0,0,0,0.6);"></div>
      <div class="container">
        <div class="row justify-content-center align-items-center" style="min-height:300px;">
          <div class="col-md-8 heading-section text-center ftco-animate text-white" style="position:relative; z-index:2;">
            <span class="subheading" style="color:#fff;">التقارير</span>
            <h2 style="color:#fff;">إدارة التقارير</h2>
            <p style="color:#eee;">هنا يمكنك عرض وإنشاء تقارير مالية وإدارية.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="ftco-section" style="background:#fff; border-radius:8px; margin-bottom:32px;">
  <div class="container py-4">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-lg animate__animated animate__fadeInUp">
          <div class="card-body">
            <h4 class="card-title mb-3" style="text-align:right;"><span class="fa fa-bar-chart text-warning ml-2"></span>أنواع التقارير</h4>
            <div class="mb-4">
              <button class="btn btn-info mr-2" onclick="showClientReportUI()">تقرير عميل</button>
              <button class="btn btn-secondary" onclick="showOfficeReportUI()">تقرير المكتب</button>
            </div>
            <div id="reportContent"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
    <footer class="footer mt-5">
      <div class="container-fluid px-lg-5">
        <div class="row">
          <div class="col-md-12 text-center py-3">
            <p class="copyright">
              &copy;<script>document.write(new Date().getFullYear());</script> جميع الحقوق محفوظة | تم التصميم والت تطوير بواسطة <a href="https://www.instagram.com/aboelmagd.megzawy/" target="_blank">أحمد زيد</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
// Demo clients
let clients = [
  { id: 1, name: 'عميل 1', mobile: '01000000001', email: 'client1@email.com', address: 'العنوان 1', details: 'تفاصيل إضافية 1' },
  { id: 2, name: 'عميل 2', mobile: '01000000002', email: 'client2@email.com', address: 'العنوان 2', details: 'تفاصيل إضافية 2' }
];
// Demo tasks
let savedTasks = [
  { id: 1, name: 'مهمة محاسبة', details: 'تفاصيل مهمة محاسبة', price: 100 },
  { id: 2, name: 'إعداد تقرير', details: 'تفاصيل إعداد تقرير', price: 200 },
  { id: 3, name: 'مراجعة سنوية', details: 'تفاصيل مراجعة سنوية', price: 300 }
];
let tasks = [
  { savedTaskId: 1, clientId: 1, dueDate: '2024-06-10', status: 'completed', extraDetails: [] },
  { savedTaskId: 2, clientId: 1, dueDate: '2024-06-15', status: 'undergoing', extraDetails: [] },
  { savedTaskId: 3, clientId: 1, dueDate: '2024-06-20', status: 'canceled', extraDetails: [] },
  { savedTaskId: 2, clientId: 2, dueDate: '2024-06-18', status: 'completed', extraDetails: [] }
];
function showClientReportUI() {
  document.getElementById('reportContent').innerHTML = `
    <div class='mb-3 d-flex flex-wrap align-items-end'>
      <select id='clientReportDropdown' class='form-control w-auto mr-2 mb-2'>
        <option value=''>اختر عميل</option>
        ${clients.map(c => `<option value='${c.id}'>${c.name}</option>`).join('')}
      </select>
      <button class='btn btn-primary mb-2' onclick='generateClientReport()'>توليد التقرير</button>
    </div>
    <div id='clientReportResult'></div>
  `;
}
function generateClientReport() {
  const clientId = parseInt(document.getElementById('clientReportDropdown').value);
  if(!clientId) { alert('يرجى اختيار عميل'); return; }
  const client = clients.find(c => c.id === clientId);
  const clientTasks = tasks.filter(t => t.clientId === clientId);
  const completed = clientTasks.filter(t => t.status === 'completed');
  const ongoing = clientTasks.filter(t => t.status === 'undergoing');
  const canceled = clientTasks.filter(t => t.status === 'canceled');
  function taskRows(arr) {
    if(arr.length === 0) return '<tr><td colspan="4">لا يوجد</td></tr>';
    return arr.map(t => {
      const st = savedTasks.find(s => s.id === t.savedTaskId);
      return `<tr><td>${st ? st.name : ''}</td><td>${st ? st.details : ''}</td><td>${t.dueDate}</td><td>${st ? st.price : ''}</td></tr>`;
    }).join('');
  }
  document.getElementById('clientReportResult').innerHTML = `
    <div id='printableReport' style='background:#f9f9f9; padding:20px; border-radius:8px;'>
      <h5 class='mb-3'>بيانات العميل</h5>
      <table class='table table-bordered text-right'><tbody>
        <tr><th>الاسم</th><td>${client.name}</td></tr>
        <tr><th>الجوال</th><td>${client.mobile}</td></tr>
        <tr><th>البريد الإلكتروني</th><td>${client.email}</td></tr>
        <tr><th>العنوان</th><td>${client.address}</td></tr>
        <tr><th>تفاصيل إضافية</th><td>${client.details}</td></tr>
      </tbody></table>
      <h5 class='mt-4 mb-2'>المهام المكتملة</h5>
      <table class='table table-bordered text-right'><thead><tr><th>اسم المهمة</th><th>التفاصيل</th><th>تاريخ الاستحقاق</th><th>السعر</th></tr></thead><tbody>${taskRows(completed)}</tbody></table>
      <h5 class='mt-4 mb-2'>المهام الجارية</h5>
      <table class='table table-bordered text-right'><thead><tr><th>اسم المهمة</th><th>التفاصيل</th><th>تاريخ الاستحقاق</th><th>السعر</th></tr></thead><tbody>${taskRows(ongoing)}</tbody></table>
      <h5 class='mt-4 mb-2'>المهام الملغاة</h5>
      <table class='table table-bordered text-right'><thead><tr><th>اسم المهمة</th><th>التفاصيل</th><th>تاريخ الاستحقاق</th><th>السعر</th></tr></thead><tbody>${taskRows(canceled)}</tbody></table>
    </div>
    <div class='mt-3'>
      <button class='btn btn-success mr-2' onclick='printReport()'>طباعة</button>
      <button class='btn btn-warning' onclick='exportPDF()'>تصدير PDF</button>
    </div>
  `;
}
function printReport() {
  const printContents = document.getElementById('printableReport').innerHTML;
  const win = window.open('', '', 'height=700,width=900');
  win.document.write('<html><head><title>تقرير عميل</title>');
  win.document.write('<style>body{direction:rtl;font-family:tahoma,Arial;}</style>');
  win.document.write('</head><body >');
  win.document.write(printContents);
  win.document.write('</body></html>');
  win.document.close();
  win.print();
}
function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
  doc.html(document.getElementById('printableReport'), {
    callback: function (doc) {
      doc.save('تقرير_عميل.pdf');
    },
    margin: [20, 20, 20, 20],
    autoPaging: 'text',
    html2canvas: { scale: 1, useCORS: true },
    x: 0,
    y: 0
  });
}
function showOfficeReportUI() {
  document.getElementById('reportContent').innerHTML = `
    <div class='mb-3 d-flex flex-wrap align-items-end'>
      <label class='mr-2 mb-0'>من</label>
      <input type='date' id='officeFromDate' class='form-control w-auto mr-2 mb-2'>
      <label class='mr-2 mb-0'>إلى</label>
      <input type='date' id='officeToDate' class='form-control w-auto mr-2 mb-2'>
      <button class='btn btn-primary mb-2' onclick='generateOfficeReport()'>توليد التقرير</button>
    </div>
    <div id='officeReportResult'></div>
  `;
}
function generateOfficeReport() {
  const from = document.getElementById('officeFromDate').value;
  const to = document.getElementById('officeToDate').value;
  if(!from || !to) { alert('يرجى اختيار تاريخ البداية والنهاية'); return; }
  const fromDate = new Date(from);
  const toDate = new Date(to);
  // Filter tasks in date range
  const filtered = tasks.filter(t => {
    const d = new Date(t.dueDate);
    return d >= fromDate && d <= toDate;
  });
  function taskRows(arr) {
    if(arr.length === 0) return '<tr><td colspan="5">لا يوجد</td></tr>';
    return arr.map(t => {
      const st = savedTasks.find(s => s.id === t.savedTaskId);
      const client = clients.find(c => c.id === t.clientId);
      return `<tr><td>${client ? client.name : ''}</td><td>${st ? st.name : ''}</td><td>${t.dueDate}</td><td>${statusLabel(t.status)}</td><td>${st ? st.price : ''}</td></tr>`;
    }).join('');
  }
  function statusLabel(status) {
    if(status === 'completed') return 'مكتملة';
    if(status === 'undergoing') return 'جارية';
    if(status === 'canceled') return 'ملغاة';
    return status;
  }
  // Totals
  let totalIncome = 0, totalExpected = 0, totalLost = 0;
  filtered.forEach(t => {
    const st = savedTasks.find(s => s.id === t.savedTaskId);
    const price = st ? st.price : 0;
    if(t.status === 'completed') totalIncome += price;
    if(t.status === 'undergoing') totalExpected += price;
    if(t.status === 'canceled') totalLost += price;
  });
  document.getElementById('officeReportResult').innerHTML = `
    <div id='printableOfficeReport' style='background:#f9f9f9; padding:20px; border-radius:8px;'>
      <h5 class='mb-3'>جميع المهام في الفترة المحددة</h5>
      <table class='table table-bordered text-right'><thead><tr><th>العميل</th><th>اسم المهمة</th><th>تاريخ الاستحقاق</th><th>الحالة</th><th>السعر</th></tr></thead><tbody>${taskRows(filtered)}</tbody></table>
      <div class='mt-4'>
        <strong>إجمالي الدخل (المهام المكتملة):</strong> <span>${totalIncome}</span><br>
        <strong>إجمالي المتوقع (المهام الجارية):</strong> <span>${totalExpected}</span><br>
        <strong>الدخل المفقود (المهام الملغاة):</strong> <span>${totalLost}</span>
      </div>
    </div>
    <div class='mt-3'>
      <button class='btn btn-success mr-2' onclick='printOfficeReport()'>طباعة</button>
      <button class='btn btn-warning' onclick='exportOfficePDF()'>تصدير PDF</button>
    </div>
  `;
}
function printOfficeReport() {
  const printContents = document.getElementById('printableOfficeReport').innerHTML;
  const win = window.open('', '', 'height=700,width=900');
  win.document.write('<html><head><title>تقرير المكتب</title>');
  win.document.write('<style>body{direction:rtl;font-family:tahoma,Arial;}</style>');
  win.document.write('</head><body >');
  win.document.write(printContents);
  win.document.write('</body></html>');
  win.document.close();
  win.print();
}
function exportOfficePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
  doc.html(document.getElementById('printableOfficeReport'), {
    callback: function (doc) {
      doc.save('تقرير_المكتب.pdf');
    },
    margin: [20, 20, 20, 20],
    autoPaging: 'text',
    html2canvas: { scale: 1, useCORS: true },
    x: 0,
    y: 0
  });
}

    </script>

  </body>
</html>
